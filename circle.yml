machine:
  python:
    version: 3.4.1
  services:
    - docker

dependencies:
  pre:
    - pip install -r requirements_test.txt
    - docker build -t minicomi .

test:
  override:
    - pep8 .
    - coverage run --source='.' manage.py test

    - docker run -d --name minicomi-postgres postgres
    - docker run -d -p 5000:5000 --link minicomi-postgres:postgres -e MINICOMI_DATABASE_PASSWORD=butt minicomi
    - curl --retry 20 --retry-delay 5 -v http://localhost:5000
