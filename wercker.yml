box: wercker/python@1.1.0

build:
  steps:
    - virtualenv@0.0.5:
        python_location: /usr/bin/python3.4

    - pip-install@0.0.6:
        packages_list: "happy==1.1.0 coverage coveralls pep8"

    - script:
        name: run pep8
        code: pep8 .

    - script:
        name: run tests
        code: coverage run --source='.' manage.py test

    - script:
        name: create Heroku app
        code: happy up --auth-token $HEROKU_AUTH_TOKEN

    - script:
        name: test Heroku app
        code: curl http://minicomi-wercker-$WERCKER_MAIN_PIPELINE_STARTED.herokuapp.com

    - script:
        name: delete Heroku app
        code: happy down --auth-token $HEROKU_AUTH_TOKEN

    - script:
        name: report test coverage to coveralls
        code: coveralls
